

<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ATT&amp;CK DS Event Mappings Notebook &#8212; The OSSEM Project</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.11.2/css/all.min.css" integrity="sha384-KA6wR/X5RY4zFAHpv/CnoG2UW1uogYfdnP67Uv7eULvTveboZJg0qUpmJZb5VqzN" crossorigin="anonymous">
    <link href="../_static/css/index.css" rel="stylesheet">
    <link rel="stylesheet" href="../_static/sphinx-book-theme.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-dropdown.css" />
    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script src="../_static/togglebutton.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/sphinx-book-theme.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script async="async" src="https://unpkg.com/thebelab@latest/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="https://ossemproject.com/notebooks/attack_ds_event_mappings_nb.html" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="docsearch:language" content="en">


<!-- Opengraph tags -->
<meta property="og:url"         content="https://ossemproject.com/notebooks/attack_ds_event_mappings_nb.html" />
<meta property="og:type"        content="article" />
<meta property="og:title"       content="ATT&amp;CK DS Event Mappings Notebook" />
<meta property="og:description" content="ATT&amp;CK DS Event Mappings Notebook    Author: Jose Luis Rodriguez - @Cyb3rPandaH  Organization: Open Threat Research (OTR)  References:  OSSEM - ATT&amp;CK Event Map" />
<meta property="og:image"       content="https://ossemproject.com/_static/logo.png" />

<meta name="twitter:card" content="summary" />


  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
<a class="navbar-brand text-wrap" href="../index.html">
  
  <img src="../_static/logo.png" class="logo" alt="logo">
  
  
  <h1 class="site-logo" id="site-title">The OSSEM Project</h1>
  
</a>
</div>

<form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form>

<nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <p class="caption">
 <span class="caption-text">
  Data Dictionaries
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../dd/intro.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dd/guidelines/intro.html">
   Guidelines
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Common Data Model
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../cdm/intro.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../cdm/guidelines/intro.html">
   Guidelines
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../cdm/entities/intro.html">
   Entities
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../cdm/tables/intro.html">
   Tables
  </a>
 </li>
</ul>
<p class="caption">
 <span class="caption-text">
  Detection Model
 </span>
</p>
<ul class="nav sidenav_l1">
 <li class="toctree-l1">
  <a class="reference internal" href="../dm/intro.html">
   Introduction
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dm/mitre_attack/intro.html">
   MITRE ATT&amp;CK
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../dm/relationships.html">
   Data Model Relationships
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="dm/attack_ds_event_mappings_nb.html">
   ATT&amp;CK DS Event Mappings Notebook
  </a>
 </li>
</ul>

</nav>

 <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="row topbar fixed-top container-xl">
    <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show">
    </div>
    <div class="col pl-2 topbar-main">
        
        <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
            data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
            aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
            title="Toggle navigation" data-toggle="tooltip" data-placement="left">
            <i class="fas fa-bars"></i>
            <i class="fas fa-arrow-left"></i>
            <i class="fas fa-arrow-up"></i>
        </button>
        
        <div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    
    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../_sources/notebooks/attack_ds_event_mappings_nb.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
    
</div>
        <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/OTRF/OSSEM"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/OTRF/OSSEM/issues/new?title=Issue%20on%20page%20%2Fnotebooks/attack_ds_event_mappings_nb.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/OTRF/OSSEM/edit/master/docs/notebooks/attack_ds_event_mappings_nb.ipynb"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>


        <!-- Full screen (wrap in <a> to have style consistency -->
        <a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
                data-placement="bottom" onclick="toggleFullScreen()" title="Fullscreen mode"><i
                    class="fas fa-expand"></i></button></a>

        <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/OTRF/OSSEM/master?urlpath=tree/docs/notebooks/attack_ds_event_mappings_nb.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="../_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/OTRF/OSSEM/blob/master/docs/notebooks/attack_ds_event_mappings_nb.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="../_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

    </div>

    <!-- Table of contents -->
    <div class="d-none d-md-block col-md-2 bd-toc show">
        <div class="tocsection onthispage pt-5 pb-3">
            <i class="fas fa-list"></i> Contents
        </div>
        <nav id="bd-toc-nav">
            <ul class="nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#importing-python-libraries">
   Importing Python Libraries
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#importing-data-sources-mapping-yaml-file">
   Importing Data Sources Mapping Yaml File
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#preparing-data-sources-mapping-dataframe">
   Preparing Data Sources Mapping Dataframe
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#visualizing-relationships-among-data-elements-network-graph">
   Visualizing Relationships Among Data Elements: Network Graph
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#mapping-sub-techniques-to-data-components-relationships-event-logs">
   Mapping (sub)techniques to data components &amp; relationships &amp; event logs
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#gathering-att-ck-content">
     Gathering ATT&amp;CK content
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#use-case-smb-windows-admin-shares-t1021-002">
     Use Case: SMB/Windows Admin Shares (T1021.002)
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#i-hope-you-find-this-notebook-helpful-d">
   I hope you find this notebook helpful!! :D
  </a>
 </li>
</ul>

        </nav>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="att-ck-ds-event-mappings-notebook">
<h1>ATT&amp;CK DS Event Mappings Notebook<a class="headerlink" href="#att-ck-ds-event-mappings-notebook" title="Permalink to this headline">¶</a></h1>
<hr class="docutils" />
<ul class="simple">
<li><p><strong>Author</strong>: Jose Luis Rodriguez - <a class="reference external" href="https://twitter.com/Cyb3rPandaH">&#64;Cyb3rPandaH</a></p></li>
<li><p><strong>Organization</strong>: <a class="reference external" href="https://github.com/OTRF">Open Threat Research (OTR)</a></p></li>
<li><p><strong>References</strong>:</p></li>
</ul>
<ul class="simple">
<li><p><a class="reference external" href="https://github.com/OTRF/OSSEM-DM/blob/main/attack_event_mapping/_attack_data_sources_all.yaml">OSSEM - ATT&amp;CK Event Mapping</a></p></li>
<li><p><a class="reference external" href="https://medium.com/mitre-attack/defining-attack-data-sources-part-i-4c39e581454f">Defining ATT&amp;CK Data Sources, Part I: Enhancing the Current State</a></p></li>
<li><p><a class="reference external" href="https://medium.com/mitre-attack/defining-attack-data-sources-part-ii-1fc98738ba5b">Defining ATT&amp;CK Data Sources, Part II: Operationalizing the Methodology</a></p></li>
<li><p><a class="reference external" href="https://github.com/mitre-attack/attack-datasources/blob/main/DataSourcesDefinition.ipynb">ATT&amp;CK - Data Sources Definition</a></p></li>
</ul>
<div class="section" id="importing-python-libraries">
<h2>Importing Python Libraries<a class="headerlink" href="#importing-python-libraries" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importing library to manipulate data</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Importing library to manipulate yaml data</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">import</span> <span class="nn">requests</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="importing-data-sources-mapping-yaml-file">
<h2>Importing Data Sources Mapping Yaml File<a class="headerlink" href="#importing-data-sources-mapping-yaml-file" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yamlUrl</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/OTRF/OSSEM-DM/main/attack_event_mapping/_all_attack_ds_mappings.yml&#39;</span>
<span class="n">yamlContent</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">yamlUrl</span><span class="p">)</span>
<span class="n">yamlMapping</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">yamlContent</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="n">mapping</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">yamlMapping</span><span class="p">)</span>
<span class="n">mapping</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>name</th>
      <th>definition</th>
      <th>collection_layers</th>
      <th>platforms</th>
      <th>contributors</th>
      <th>data_components</th>
      <th>references</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>User Account</td>
      <td>Security principal or entity that represents a...</td>
      <td>[host]</td>
      <td>[Windows]</td>
      <td>[Jose Rodriguez @Cyb3rPandaH, Roberto Rodrigue...</td>
      <td>[{'name': 'user account creation', 'type': 'ac...</td>
      <td>[https://docs.microsoft.com/en-us/windows/secu...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Schedule Task</td>
      <td>Information about scheduled work that the Task...</td>
      <td>[host]</td>
      <td>[Windows]</td>
      <td>[Jose Rodriguez @Cyb3rPandaH, Roberto Rodrigue...</td>
      <td>[{'name': 'schedule task creation', 'type': 'a...</td>
      <td>[https://docs.microsoft.com/en-us/windows/win3...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>WMI object</td>
      <td>Information about objects from the system clas...</td>
      <td>[host]</td>
      <td>[Windows]</td>
      <td>[Jose Rodriguez @Cyb3rPandaH, Roberto Rodrigue...</td>
      <td>[{'name': 'wmi object context', 'type': 'infor...</td>
      <td>[https://docs.microsoft.com/en-us/windows/win3...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Process</td>
      <td>Information about instances of computer progra...</td>
      <td>[host]</td>
      <td>[Windows]</td>
      <td>[Jose Rodriguez @Cyb3rPandaH, Roberto Rodrigue...</td>
      <td>[{'name': 'process context', 'type': 'informat...</td>
      <td>[https://docs.microsoft.com/en-us/windows/win3...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Module</td>
      <td>Information about portable executable files, s...</td>
      <td>[host]</td>
      <td>[Windows]</td>
      <td>[Jose Rodriguez @Cyb3rPandaH, Roberto Rodrigue...</td>
      <td>[{'name': 'module load', 'type': 'activity', '...</td>
      <td>[https://docs.microsoft.com/en-us/windows/win3...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="preparing-data-sources-mapping-dataframe">
<h2>Preparing Data Sources Mapping Dataframe<a class="headerlink" href="#preparing-data-sources-mapping-dataframe" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Splitting rows for data_components list</span>
<span class="n">dcListExp</span> <span class="o">=</span> <span class="n">mapping</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;data_components&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;data_sources&#39;</span><span class="p">})</span>

<span class="c1"># Splitting columns for data_components dict</span>
<span class="n">dcDictExp</span> <span class="o">=</span> <span class="n">dcListExp</span><span class="p">[</span><span class="s1">&#39;data_components&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">dcListExp</span><span class="p">,</span><span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>\
<span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;components&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;data_components&#39;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Splitting rows for relationships list</span>
<span class="n">drListExp</span> <span class="o">=</span> <span class="n">dcDictExp</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;relationships&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Splitting columns for relationships dict</span>
<span class="n">drDictExp</span> <span class="o">=</span> <span class="n">drListExp</span><span class="p">[</span><span class="s1">&#39;relationships&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">drListExp</span><span class="p">,</span><span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>\
<span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;name&#39;</span><span class="p">:</span><span class="s1">&#39;data_relationships&#39;</span><span class="p">})</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;relationships&#39;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Splitting rows for telemetry list</span>
<span class="n">tListExp</span> <span class="o">=</span> <span class="n">drDictExp</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;telemetry&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Splitting columnes for telemetry dict</span>
<span class="n">tDictExp</span> <span class="o">=</span> <span class="n">tListExp</span><span class="p">[</span><span class="s1">&#39;telemetry&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">tListExp</span><span class="p">,</span><span class="n">left_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span><span class="n">right_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>\
<span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">drop</span><span class="p">([</span><span class="s1">&#39;telemetry&#39;</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>

<span class="c1"># Splitting rows for event_id list</span>
<span class="n">dataSourcesMapping</span> <span class="o">=</span> <span class="n">tDictExp</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;event_id&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">dataSourcesMapping</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>log_provider</th>
      <th>log_channel</th>
      <th>audit_category</th>
      <th>audit_sub_category</th>
      <th>event_id</th>
      <th>event_name</th>
      <th>data_relationships</th>
      <th>id</th>
      <th>source_data_element</th>
      <th>relationship</th>
      <th>target_data_element</th>
      <th>components</th>
      <th>type</th>
      <th>data_sources</th>
      <th>definition</th>
      <th>collection_layers</th>
      <th>platforms</th>
      <th>contributors</th>
      <th>references</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>Microsoft-Windows-Security-Auditing</td>
      <td>Security</td>
      <td>Account Management</td>
      <td>User Account Management</td>
      <td>4720</td>
      <td>A user account was created.</td>
      <td>User created User</td>
      <td>0C55D5FB-1FCC-454B-9C4A-0E72116D4BE3</td>
      <td>user</td>
      <td>created</td>
      <td>user</td>
      <td>user account creation</td>
      <td>activity</td>
      <td>User Account</td>
      <td>Security principal or entity that represents a...</td>
      <td>[host]</td>
      <td>[Windows]</td>
      <td>[Jose Rodriguez @Cyb3rPandaH, Roberto Rodrigue...</td>
      <td>[https://docs.microsoft.com/en-us/windows/secu...</td>
    </tr>
    <tr>
      <th>1</th>
      <td>Microsoft-Windows-Security-Auditing</td>
      <td>Security</td>
      <td>Account Management</td>
      <td>User Account Management</td>
      <td>4726</td>
      <td>A user account was deleted.</td>
      <td>User deleted User</td>
      <td>B215E53A-D35F-4ED2-BBFE-9516C30B9F96</td>
      <td>user</td>
      <td>deleted</td>
      <td>user</td>
      <td>user account deletion</td>
      <td>activity</td>
      <td>User Account</td>
      <td>Security principal or entity that represents a...</td>
      <td>[host]</td>
      <td>[Windows]</td>
      <td>[Jose Rodriguez @Cyb3rPandaH, Roberto Rodrigue...</td>
      <td>[https://docs.microsoft.com/en-us/windows/secu...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>Microsoft-Windows-Security-Auditing</td>
      <td>Security</td>
      <td>Account Management</td>
      <td>User Account Management</td>
      <td>4722</td>
      <td>A user account was enabled.</td>
      <td>User enabled User</td>
      <td>B3F266ED-866B-4263-8551-C0FBCE341805</td>
      <td>user</td>
      <td>enabled</td>
      <td>user</td>
      <td>user account enable</td>
      <td>activity</td>
      <td>User Account</td>
      <td>Security principal or entity that represents a...</td>
      <td>[host]</td>
      <td>[Windows]</td>
      <td>[Jose Rodriguez @Cyb3rPandaH, Roberto Rodrigue...</td>
      <td>[https://docs.microsoft.com/en-us/windows/secu...</td>
    </tr>
    <tr>
      <th>3</th>
      <td>Microsoft-Windows-Security-Auditing</td>
      <td>Security</td>
      <td>Account Management</td>
      <td>User Account Management</td>
      <td>4725</td>
      <td>A user account was disabled.</td>
      <td>User disabled User</td>
      <td>2B984BA0-4788-4FAA-8E10-F6C1DC07C35E</td>
      <td>user</td>
      <td>disabled</td>
      <td>user</td>
      <td>user account disable</td>
      <td>activity</td>
      <td>User Account</td>
      <td>Security principal or entity that represents a...</td>
      <td>[host]</td>
      <td>[Windows]</td>
      <td>[Jose Rodriguez @Cyb3rPandaH, Roberto Rodrigue...</td>
      <td>[https://docs.microsoft.com/en-us/windows/secu...</td>
    </tr>
    <tr>
      <th>4</th>
      <td>Microsoft-Windows-Security-Auditing</td>
      <td>Security</td>
      <td>Account Management</td>
      <td>User Account Management</td>
      <td>4740</td>
      <td>A user account was locked out.</td>
      <td>User locked User</td>
      <td>8F03BCE0-7EAB-41BA-976F-FBA406412A16</td>
      <td>user</td>
      <td>locked</td>
      <td>user</td>
      <td>user account lock</td>
      <td>activity</td>
      <td>User Account</td>
      <td>Security principal or entity that represents a...</td>
      <td>[host]</td>
      <td>[Windows]</td>
      <td>[Jose Rodriguez @Cyb3rPandaH, Roberto Rodrigue...</td>
      <td>[https://docs.microsoft.com/en-us/windows/secu...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="visualizing-relationships-among-data-elements-network-graph">
<h2>Visualizing Relationships Among Data Elements: Network Graph<a class="headerlink" href="#visualizing-relationships-among-data-elements-network-graph" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Getting dataframe of relationships among data elements</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">relationships</span> <span class="o">=</span> <span class="n">dataSourcesMapping</span><span class="p">[[</span><span class="s1">&#39;source_data_element&#39;</span><span class="p">,</span><span class="s1">&#39;target_data_element&#39;</span><span class="p">,</span><span class="s1">&#39;relationship&#39;</span><span class="p">]]</span>\
      <span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>\
      <span class="o">.</span><span class="n">dropna</span><span class="p">()</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>\
      <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;source_data_element&#39;</span><span class="p">:</span><span class="s1">&#39;source&#39;</span><span class="p">,</span><span class="s1">&#39;target_data_element&#39;</span><span class="p">:</span><span class="s1">&#39;target&#39;</span><span class="p">})</span>\
      <span class="o">.</span><span class="n">replace</span><span class="p">([</span><span class="s1">&#39;windows registry key&#39;</span><span class="p">,</span><span class="s1">&#39;windows registry key value&#39;</span><span class="p">],[</span><span class="s1">&#39;registry key&#39;</span><span class="p">,</span><span class="s1">&#39;registry key value&#39;</span><span class="p">])</span>
<span class="n">relationships</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>source</th>
      <th>target</th>
      <th>relationship</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>user</td>
      <td>user</td>
      <td>created</td>
    </tr>
    <tr>
      <th>1</th>
      <td>user</td>
      <td>user</td>
      <td>deleted</td>
    </tr>
    <tr>
      <th>2</th>
      <td>user</td>
      <td>user</td>
      <td>enabled</td>
    </tr>
    <tr>
      <th>3</th>
      <td>user</td>
      <td>user</td>
      <td>disabled</td>
    </tr>
    <tr>
      <th>4</th>
      <td>user</td>
      <td>user</td>
      <td>locked</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Importing libraries</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">networkx</span> <span class="k">as</span> <span class="nn">nx</span>

<span class="kn">from</span> <span class="nn">bokeh.io</span> <span class="kn">import</span> <span class="n">output_notebook</span><span class="p">,</span> <span class="n">show</span>
<span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="p">(</span><span class="n">BoxSelectTool</span><span class="p">,</span><span class="n">LassoSelectTool</span><span class="p">,</span><span class="n">PanTool</span><span class="p">,</span><span class="n">BoxZoomTool</span><span class="p">,</span><span class="n">ResetTool</span><span class="p">,</span><span class="n">TapTool</span><span class="p">,</span>
                          <span class="n">WheelZoomTool</span><span class="p">,</span><span class="n">HoverTool</span><span class="p">,</span><span class="n">Circle</span><span class="p">,</span> <span class="n">MultiLine</span><span class="p">,</span><span class="n">Plot</span><span class="p">,</span> <span class="n">Range1d</span><span class="p">,</span><span class="n">ColumnDataSource</span><span class="p">,</span>
                          <span class="n">PointDrawTool</span><span class="p">,</span><span class="n">LabelSet</span><span class="p">,</span><span class="n">EdgesAndLinkedNodes</span><span class="p">,</span> <span class="n">NodesAndLinkedEdges</span><span class="p">,</span><span class="n">HoverTool</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">bokeh.palettes</span> <span class="kn">import</span> <span class="n">Spectral5</span>
<span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="kn">import</span> <span class="n">from_networkx</span>

<span class="n">output_notebook</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">
<div class="bk-root">
    <a href="https://bokeh.org" target="_blank" class="bk-logo bk-logo-small bk-logo-notebook"></a>
    <span id="1001">Loading BokehJS ...</span>
</div></div><script type="application/javascript">
(function(root) {
  function now() {
    return new Date();
  }

  var force = true;

  if (typeof root._bokeh_onload_callbacks === "undefined" || force === true) {
    root._bokeh_onload_callbacks = [];
    root._bokeh_is_loading = undefined;
  }

  var JS_MIME_TYPE = 'application/javascript';
  var HTML_MIME_TYPE = 'text/html';
  var EXEC_MIME_TYPE = 'application/vnd.bokehjs_exec.v0+json';
  var CLASS_NAME = 'output_bokeh rendered_html';

  /**
   * Render data to the DOM node
   */
  function render(props, node) {
    var script = document.createElement("script");
    node.appendChild(script);
  }

  /**
   * Handle when an output is cleared or removed
   */
  function handleClearOutput(event, handle) {
    var cell = handle.cell;

    var id = cell.output_area._bokeh_element_id;
    var server_id = cell.output_area._bokeh_server_id;
    // Clean up Bokeh references
    if (id != null && id in Bokeh.index) {
      Bokeh.index[id].model.document.clear();
      delete Bokeh.index[id];
    }

    if (server_id !== undefined) {
      // Clean up Bokeh references
      var cmd = "from bokeh.io.state import curstate; print(curstate().uuid_to_server['" + server_id + "'].get_sessions()[0].document.roots[0]._id)";
      cell.notebook.kernel.execute(cmd, {
        iopub: {
          output: function(msg) {
            var id = msg.content.text.trim();
            if (id in Bokeh.index) {
              Bokeh.index[id].model.document.clear();
              delete Bokeh.index[id];
            }
          }
        }
      });
      // Destroy server and session
      var cmd = "import bokeh.io.notebook as ion; ion.destroy_server('" + server_id + "')";
      cell.notebook.kernel.execute(cmd);
    }
  }

  /**
   * Handle when a new output is added
   */
  function handleAddOutput(event, handle) {
    var output_area = handle.output_area;
    var output = handle.output;

    // limit handleAddOutput to display_data with EXEC_MIME_TYPE content only
    if ((output.output_type != "display_data") || (!output.data.hasOwnProperty(EXEC_MIME_TYPE))) {
      return
    }

    var toinsert = output_area.element.find("." + CLASS_NAME.split(' ')[0]);

    if (output.metadata[EXEC_MIME_TYPE]["id"] !== undefined) {
      toinsert[toinsert.length - 1].firstChild.textContent = output.data[JS_MIME_TYPE];
      // store reference to embed id on output_area
      output_area._bokeh_element_id = output.metadata[EXEC_MIME_TYPE]["id"];
    }
    if (output.metadata[EXEC_MIME_TYPE]["server_id"] !== undefined) {
      var bk_div = document.createElement("div");
      bk_div.innerHTML = output.data[HTML_MIME_TYPE];
      var script_attrs = bk_div.children[0].attributes;
      for (var i = 0; i < script_attrs.length; i++) {
        toinsert[toinsert.length - 1].firstChild.setAttribute(script_attrs[i].name, script_attrs[i].value);
        toinsert[toinsert.length - 1].firstChild.textContent = bk_div.children[0].textContent
      }
      // store reference to server id on output_area
      output_area._bokeh_server_id = output.metadata[EXEC_MIME_TYPE]["server_id"];
    }
  }

  function register_renderer(events, OutputArea) {

    function append_mime(data, metadata, element) {
      // create a DOM node to render to
      var toinsert = this.create_output_subarea(
        metadata,
        CLASS_NAME,
        EXEC_MIME_TYPE
      );
      this.keyboard_manager.register_events(toinsert);
      // Render to node
      var props = {data: data, metadata: metadata[EXEC_MIME_TYPE]};
      render(props, toinsert[toinsert.length - 1]);
      element.append(toinsert);
      return toinsert
    }

    /* Handle when an output is cleared or removed */
    events.on('clear_output.CodeCell', handleClearOutput);
    events.on('delete.Cell', handleClearOutput);

    /* Handle when a new output is added */
    events.on('output_added.OutputArea', handleAddOutput);

    /**
     * Register the mime type and append_mime function with output_area
     */
    OutputArea.prototype.register_mime_type(EXEC_MIME_TYPE, append_mime, {
      /* Is output safe? */
      safe: true,
      /* Index of renderer in `output_area.display_order` */
      index: 0
    });
  }

  // register the mime type if in Jupyter Notebook environment and previously unregistered
  if (root.Jupyter !== undefined) {
    var events = require('base/js/events');
    var OutputArea = require('notebook/js/outputarea').OutputArea;

    if (OutputArea.prototype.mime_types().indexOf(EXEC_MIME_TYPE) == -1) {
      register_renderer(events, OutputArea);
    }
  }

  
  if (typeof (root._bokeh_timeout) === "undefined" || force === true) {
    root._bokeh_timeout = Date.now() + 5000;
    root._bokeh_failed_load = false;
  }

  var NB_LOAD_WARNING = {'data': {'text/html':
     "<div style='background-color: #fdd'>\n"+
     "<p>\n"+
     "BokehJS does not appear to have successfully loaded. If loading BokehJS from CDN, this \n"+
     "may be due to a slow or bad network connection. Possible fixes:\n"+
     "</p>\n"+
     "<ul>\n"+
     "<li>re-rerun `output_notebook()` to attempt to load from CDN again, or</li>\n"+
     "<li>use INLINE resources instead, as so:</li>\n"+
     "</ul>\n"+
     "<code>\n"+
     "from bokeh.resources import INLINE\n"+
     "output_notebook(resources=INLINE)\n"+
     "</code>\n"+
     "</div>"}};

  function display_loaded() {
    var el = document.getElementById("1001");
    if (el != null) {
      el.textContent = "BokehJS is loading...";
    }
    if (root.Bokeh !== undefined) {
      if (el != null) {
        el.textContent = "BokehJS " + root.Bokeh.version + " successfully loaded.";
      }
    } else if (Date.now() < root._bokeh_timeout) {
      setTimeout(display_loaded, 100)
    }
  }


  function run_callbacks() {
    try {
      root._bokeh_onload_callbacks.forEach(function(callback) {
        if (callback != null)
          callback();
      });
    } finally {
      delete root._bokeh_onload_callbacks
    }
    console.debug("Bokeh: all callbacks have finished");
  }

  function load_libs(css_urls, js_urls, callback) {
    if (css_urls == null) css_urls = [];
    if (js_urls == null) js_urls = [];

    root._bokeh_onload_callbacks.push(callback);
    if (root._bokeh_is_loading > 0) {
      console.debug("Bokeh: BokehJS is being loaded, scheduling callback at", now());
      return null;
    }
    if (js_urls == null || js_urls.length === 0) {
      run_callbacks();
      return null;
    }
    console.debug("Bokeh: BokehJS not loaded, scheduling load and callback at", now());
    root._bokeh_is_loading = css_urls.length + js_urls.length;

    function on_load() {
      root._bokeh_is_loading--;
      if (root._bokeh_is_loading === 0) {
        console.debug("Bokeh: all BokehJS libraries/stylesheets loaded");
        run_callbacks()
      }
    }

    function on_error() {
      console.error("failed to load " + url);
    }

    for (var i = 0; i < css_urls.length; i++) {
      var url = css_urls[i];
      const element = document.createElement("link");
      element.onload = on_load;
      element.onerror = on_error;
      element.rel = "stylesheet";
      element.type = "text/css";
      element.href = url;
      console.debug("Bokeh: injecting link tag for BokehJS stylesheet: ", url);
      document.body.appendChild(element);
    }

    const hashes = {"https://cdn.bokeh.org/bokeh/release/bokeh-2.2.2.min.js": "JayppSWSRBsibIZqI8S4vAb1oFgLL0uhNvSn8cmArlOvYOwfFjYeyY5UWwJ+K0SU", "https://cdn.bokeh.org/bokeh/release/bokeh-widgets-2.2.2.min.js": "G0/Tv/Yy/zEPNsnW0Qif/FOsGesd+KIrKg/QLmvQmReuUW9qmSP7mAmr0VpiUNr3", "https://cdn.bokeh.org/bokeh/release/bokeh-tables-2.2.2.min.js": "VLYHEbLQDk5G1+/4ALU0myoJPMEUsngWry2fzYorFOUmarjGRPLLURaeK/on6JqX"};

    for (var i = 0; i < js_urls.length; i++) {
      var url = js_urls[i];
      var element = document.createElement('script');
      element.onload = on_load;
      element.onerror = on_error;
      element.async = false;
      element.src = url;
      if (url in hashes) {
        element.crossOrigin = "anonymous";
        element.integrity = "sha384-" + hashes[url];
      }
      console.debug("Bokeh: injecting script tag for BokehJS library: ", url);
      document.head.appendChild(element);
    }
  };

  function inject_raw_css(css) {
    const element = document.createElement("style");
    element.appendChild(document.createTextNode(css));
    document.body.appendChild(element);
  }

  
  var js_urls = ["https://cdn.bokeh.org/bokeh/release/bokeh-2.2.2.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-widgets-2.2.2.min.js", "https://cdn.bokeh.org/bokeh/release/bokeh-tables-2.2.2.min.js"];
  var css_urls = [];
  

  var inline_js = [
    function(Bokeh) {
      Bokeh.set_log_level("info");
    },
    function(Bokeh) {
    
    
    }
  ];

  function run_inline_js() {
    
    if (root.Bokeh !== undefined || force === true) {
      
    for (var i = 0; i < inline_js.length; i++) {
      inline_js[i].call(root, root.Bokeh);
    }
    if (force === true) {
        display_loaded();
      }} else if (Date.now() < root._bokeh_timeout) {
      setTimeout(run_inline_js, 100);
    } else if (!root._bokeh_failed_load) {
      console.log("Bokeh: BokehJS failed to load within specified timeout.");
      root._bokeh_failed_load = true;
    } else if (force !== true) {
      var cell = $(document.getElementById("1001")).parents('.cell').data().cell;
      cell.output_area.append_execute_result(NB_LOAD_WARNING)
    }

  }

  if (root._bokeh_is_loading === 0) {
    console.debug("Bokeh: BokehJS loaded, going straight to plotting");
    run_inline_js();
  } else {
    load_libs(css_urls, js_urls, function() {
      console.debug("Bokeh: BokehJS plotting callback run at", now());
      run_inline_js();
    });
  }
}(window));</script></div>
</div>
<ul class="simple">
<li><p>Visualizing network graph</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Creating networkx graph object</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">nx</span><span class="o">.</span><span class="n">from_pandas_edgelist</span><span class="p">(</span><span class="n">relationships</span><span class="p">,</span> <span class="n">source</span> <span class="o">=</span> <span class="s1">&#39;source&#39;</span><span class="p">,</span> <span class="n">target</span> <span class="o">=</span> <span class="s1">&#39;target&#39;</span><span class="p">,</span><span class="n">edge_attr</span> <span class="o">=</span> <span class="s1">&#39;relationship&#39;</span><span class="p">)</span>

<span class="c1"># Creating plot object</span>
<span class="n">plot</span> <span class="o">=</span> <span class="n">Plot</span><span class="p">(</span><span class="n">plot_width</span><span class="o">=</span><span class="mi">800</span><span class="p">,</span> <span class="n">plot_height</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
            <span class="n">x_range</span><span class="o">=</span><span class="n">Range1d</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">),</span> <span class="n">y_range</span><span class="o">=</span><span class="n">Range1d</span><span class="p">(</span><span class="o">-</span><span class="mf">1.1</span><span class="p">,</span> <span class="mf">1.1</span><span class="p">))</span>
<span class="n">plot</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">text</span> <span class="o">=</span> <span class="s2">&quot;Relationships among Data Elements&quot;</span>
<span class="n">plot</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">align</span> <span class="o">=</span> <span class="s2">&quot;center&quot;</span>
<span class="n">plot</span><span class="o">.</span><span class="n">title</span><span class="o">.</span><span class="n">text_font_size</span> <span class="o">=</span> <span class="s2">&quot;30px&quot;</span>

<span class="c1"># Creating renderer objects</span>
<span class="n">graph_renderer</span> <span class="o">=</span> <span class="n">from_networkx</span><span class="p">(</span><span class="n">G</span><span class="p">,</span> <span class="n">nx</span><span class="o">.</span><span class="n">spring_layout</span><span class="p">,</span> <span class="n">scale</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>

<span class="n">graph_renderer</span><span class="o">.</span><span class="n">node_renderer</span><span class="o">.</span><span class="n">glyph</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">60</span><span class="p">,</span> <span class="n">fill_color</span><span class="o">=</span><span class="n">Spectral5</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">graph_renderer</span><span class="o">.</span><span class="n">node_renderer</span><span class="o">.</span><span class="n">selection_glyph</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">fill_color</span><span class="o">=</span><span class="n">Spectral5</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
<span class="n">graph_renderer</span><span class="o">.</span><span class="n">node_renderer</span><span class="o">.</span><span class="n">hover_glyph</span> <span class="o">=</span> <span class="n">Circle</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="mi">15</span><span class="p">,</span> <span class="n">fill_color</span><span class="o">=</span><span class="n">Spectral5</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

<span class="n">graph_renderer</span><span class="o">.</span><span class="n">edge_renderer</span><span class="o">.</span><span class="n">glyph</span> <span class="o">=</span> <span class="n">MultiLine</span><span class="p">(</span><span class="n">line_color</span><span class="o">=</span><span class="s2">&quot;gray&quot;</span><span class="p">,</span> <span class="n">line_alpha</span><span class="o">=</span><span class="mf">0.9</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">graph_renderer</span><span class="o">.</span><span class="n">edge_renderer</span><span class="o">.</span><span class="n">selection_glyph</span> <span class="o">=</span> <span class="n">MultiLine</span><span class="p">(</span><span class="n">line_color</span><span class="o">=</span><span class="n">Spectral5</span><span class="p">[</span><span class="mi">3</span><span class="p">],</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="n">graph_renderer</span><span class="o">.</span><span class="n">edge_renderer</span><span class="o">.</span><span class="n">hover_glyph</span> <span class="o">=</span> <span class="n">MultiLine</span><span class="p">(</span><span class="n">line_color</span><span class="o">=</span><span class="n">Spectral5</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

<span class="n">graph_renderer</span><span class="o">.</span><span class="n">selection_policy</span> <span class="o">=</span> <span class="n">NodesAndLinkedEdges</span><span class="p">()</span>
<span class="n">graph_renderer</span><span class="o">.</span><span class="n">inspection_policy</span> <span class="o">=</span> <span class="n">NodesAndLinkedEdges</span><span class="p">()</span>
<span class="n">plot</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">graph_renderer</span><span class="p">)</span>

<span class="c1"># Adding nodes labels</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">graph_renderer</span><span class="o">.</span><span class="n">layout_provider</span><span class="o">.</span><span class="n">graph_layout</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>

<span class="n">names</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">nx</span><span class="o">.</span><span class="n">nodes</span><span class="p">(</span><span class="n">G</span><span class="p">):</span> <span class="n">names</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> 
    
<span class="n">nodes_table</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">({</span><span class="s1">&#39;x&#39;</span><span class="p">:</span> <span class="n">x</span><span class="p">,</span> <span class="s1">&#39;y&#39;</span><span class="p">:</span> <span class="n">y</span><span class="p">,</span><span class="s1">&#39;name&#39;</span><span class="p">:</span> <span class="n">names</span><span class="p">})</span>
<span class="n">labels</span> <span class="o">=</span> <span class="n">LabelSet</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;x&#39;</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="n">render_mode</span><span class="o">=</span><span class="s1">&#39;canvas&#39;</span><span class="p">,</span><span class="n">y_offset</span><span class="o">=-</span><span class="mi">10</span><span class="p">,</span><span class="n">text_align</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span>
                  <span class="n">text_font_size</span><span class="o">=</span><span class="s1">&#39;12px&#39;</span><span class="p">,</span><span class="n">source</span> <span class="o">=</span> <span class="n">nodes_table</span><span class="p">,</span> <span class="n">background_fill_color</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">text_color</span> <span class="o">=</span> <span class="s1">&#39;black&#39;</span><span class="p">)</span>

<span class="n">plot</span><span class="o">.</span><span class="n">renderers</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">labels</span><span class="p">)</span>

<span class="c1"># Adding tools</span>
<span class="n">plot</span><span class="o">.</span><span class="n">add_tools</span><span class="p">(</span><span class="n">HoverTool</span><span class="p">(</span><span class="n">tooltips</span><span class="o">=</span><span class="kc">None</span><span class="p">),</span><span class="n">WheelZoomTool</span><span class="p">(),</span><span class="n">TapTool</span><span class="p">(),</span><span class="n">BoxSelectTool</span><span class="p">(),</span><span class="n">BoxZoomTool</span><span class="p">(),</span>
               <span class="n">PanTool</span><span class="p">(),</span><span class="n">LassoSelectTool</span><span class="p">(),</span><span class="n">ResetTool</span><span class="p">())</span>

<span class="c1"># Showing graph</span>
<span class="n">show</span><span class="p">(</span><span class="n">plot</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html">





<div class="bk-root" id="0acb3eed-a42e-44f2-946c-386d70c25c57" data-root-id="1004"></div>
</div><script type="application/javascript">(function(root) {
  function embed_document(root) {
    
  var docs_json = {"bd0604e9-f80a-428d-b93c-ceebea11592f":{"roots":{"references":[{"attributes":{"plot_height":500,"plot_width":800,"renderers":[{"id":"1010"},{"id":"1055"}],"title":{"id":"1007"},"toolbar":{"id":"1065"},"x_range":{"id":"1002"},"x_scale":{"id":"1075"},"y_range":{"id":"1003"},"y_scale":{"id":"1074"}},"id":"1004","type":"Plot"},{"attributes":{},"id":"1050","type":"NodesAndLinkedEdges"},{"attributes":{},"id":"1074","type":"LinearScale"},{"attributes":{"data_source":{"id":"1012"},"glyph":{"id":"1020"},"hover_glyph":{"id":"1030"},"muted_glyph":null,"selection_glyph":{"id":"1025"},"view":{"id":"1014"}},"id":"1013","type":"GlyphRenderer"},{"attributes":{"source":{"id":"1012"}},"id":"1014","type":"CDSView"},{"attributes":{"data":{"end":["user","schedule task","wmi filter","wmi consumer","wmi subscription","process","port","ip","host","service","file","file share","ad object","registry key","registry key value","logon session","application host","process","thread","port","ip","host","dll","executable","file","ad object","pipe","registry key","registry key value","command","dns query","host","host"],"relationship":["removed access","modified","deleted","deleted","deleted","terminated","failed logon session creation from","failed logon session creation from","failed creation","requested access","modified","modified","modified","requested access","modified","terminated","started","requested access","created","attempted to bind on","attempted connection from","blocked local port bind on","loaded","loaded","modified","requested access","connected to","requested access","modified","executed","executed","blocked local port bind on","blocked local port bind on"],"start":["user","user","user","user","user","user","user","user","user","user","user","user","user","user","user","user","user","process","process","process","process","process","process","process","process","process","process","process","process","process","process","port","ip"]},"selected":{"id":"1091"},"selection_policy":{"id":"1090"}},"id":"1016","type":"ColumnDataSource"},{"attributes":{},"id":"1090","type":"UnionRenderers"},{"attributes":{},"id":"1075","type":"LinearScale"},{"attributes":{},"id":"1091","type":"Selection"},{"attributes":{},"id":"1089","type":"Selection"},{"attributes":{"source":{"id":"1016"}},"id":"1018","type":"CDSView"},{"attributes":{"data_source":{"id":"1016"},"glyph":{"id":"1035"},"hover_glyph":{"id":"1045"},"muted_glyph":null,"selection_glyph":{"id":"1040"},"view":{"id":"1018"}},"id":"1017","type":"GlyphRenderer"},{"attributes":{},"id":"1088","type":"UnionRenderers"},{"attributes":{"data":{"name":["user","schedule task","wmi filter","wmi consumer","wmi subscription","process","thread","port","ip","host","dll","executable","service","file","file share","ad object","pipe","registry key","registry key value","logon session","application host","command","dns query"],"x":[0.3092142673278019,0.6445677188579815,0.4090440848007433,0.9407117894225533,0.772630653963621,-0.39967871564057256,-0.98600099423066,-0.2654496770651132,-0.09293702477060059,-0.23931804005956403,-0.8958512047456156,-1.0,0.8814720508404704,-0.04232943366064596,0.846950824488933,0.0926927761055378,-0.6636890030672432,-0.05894740913179271,0.15700718748509562,0.6905967027341697,0.1542178588943245,-0.8583157781604728,-0.3965886343889565],"y":[-0.15870197056836918,-0.7050931807739589,-0.741661595596675,-0.10767449245162444,-0.5167217921709881,0.20492157496351965,0.37635355395006703,-0.3040019169811,0.011102488963881697,-0.1202879487415345,-0.1311609699758293,0.12441688142725019,-0.32639879143205325,0.3256982219544395,0.11077133812663864,0.1469331600728587,0.7482611562469741,-0.2484960765972653,0.3570402532246281,0.31075293054113134,-0.7501068767664933,0.5894387159790245,0.8046153366054791]},"selected":{"id":"1089"},"selection_policy":{"id":"1088"}},"id":"1054","type":"ColumnDataSource"},{"attributes":{},"id":"1092","type":"UnionRenderers"},{"attributes":{"fill_color":{"value":"#2b83ba"},"size":{"units":"screen","value":60}},"id":"1020","type":"Circle"},{"attributes":{"callback":null,"tooltips":null},"id":"1057","type":"HoverTool"},{"attributes":{},"id":"1062","type":"PanTool"},{"attributes":{},"id":"1093","type":"Selection"},{"attributes":{"fill_alpha":0.5,"fill_color":"lightgrey","level":"overlay","line_alpha":1.0,"line_color":"black","line_dash":[4,4],"line_width":2,"xs_units":"screen","ys_units":"screen"},"id":"1087","type":"PolyAnnotation"},{"attributes":{"fill_color":{"value":"#abdda4"},"size":{"units":"screen","value":15}},"id":"1030","type":"Circle"},{"attributes":{"overlay":{"id":"1087"}},"id":"1063","type":"LassoSelectTool"},{"attributes":{"overlay":{"id":"1085"}},"id":"1060","type":"BoxSelectTool"},{"attributes":{"end":1.1,"start":-1.1},"id":"1002","type":"Range1d"},{"attributes":{"end":1.1,"start":-1.1},"id":"1003","type":"Range1d"},{"attributes":{"line_color":{"value":"#abdda4"},"line_width":{"value":4}},"id":"1045","type":"MultiLine"},{"attributes":{"fill_color":{"value":"#fdae61"},"size":{"units":"screen","value":15}},"id":"1025","type":"Circle"},{"attributes":{},"id":"1064","type":"ResetTool"},{"attributes":{"align":"center","text":"Relationships among Data Elements","text_font_size":{"value":"30px"}},"id":"1007","type":"Title"},{"attributes":{},"id":"1058","type":"WheelZoomTool"},{"attributes":{"overlay":{"id":"1086"}},"id":"1061","type":"BoxZoomTool"},{"attributes":{"callback":null},"id":"1059","type":"TapTool"},{"attributes":{"bottom_units":"screen","fill_alpha":0.5,"fill_color":"lightgrey","left_units":"screen","level":"overlay","line_alpha":1.0,"line_color":"black","line_dash":[4,4],"line_width":2,"right_units":"screen","top_units":"screen"},"id":"1085","type":"BoxAnnotation"},{"attributes":{"data":{"index":["user","schedule task","wmi filter","wmi consumer","wmi subscription","process","thread","port","ip","host","dll","executable","service","file","file share","ad object","pipe","registry key","registry key value","logon session","application host","command","dns query"]},"selected":{"id":"1093"},"selection_policy":{"id":"1092"}},"id":"1012","type":"ColumnDataSource"},{"attributes":{"active_drag":"auto","active_inspect":"auto","active_multi":null,"active_scroll":"auto","active_tap":"auto","tools":[{"id":"1057"},{"id":"1058"},{"id":"1059"},{"id":"1060"},{"id":"1061"},{"id":"1062"},{"id":"1063"},{"id":"1064"}]},"id":"1065","type":"Toolbar"},{"attributes":{},"id":"1052","type":"NodesAndLinkedEdges"},{"attributes":{"edge_renderer":{"id":"1017"},"inspection_policy":{"id":"1052"},"layout_provider":{"id":"1019"},"node_renderer":{"id":"1013"},"selection_policy":{"id":"1050"}},"id":"1010","type":"GraphRenderer"},{"attributes":{"line_color":{"value":"#fdae61"},"line_width":{"value":4}},"id":"1040","type":"MultiLine"},{"attributes":{"source":{"id":"1054"},"text":{"field":"name"},"text_align":"center","text_color":{"value":"black"},"text_font_size":{"value":"12px"},"x":{"field":"x"},"y":{"field":"y"},"y_offset":{"value":-10}},"id":"1055","type":"LabelSet"},{"attributes":{"bottom_units":"screen","fill_alpha":0.5,"fill_color":"lightgrey","left_units":"screen","level":"overlay","line_alpha":1.0,"line_color":"black","line_dash":[4,4],"line_width":2,"right_units":"screen","top_units":"screen"},"id":"1086","type":"BoxAnnotation"},{"attributes":{"line_alpha":{"value":0.9},"line_color":{"value":"gray"}},"id":"1035","type":"MultiLine"},{"attributes":{"graph_layout":{"ad object":[0.0926927761055378,0.1469331600728587],"application host":[0.1542178588943245,-0.7501068767664933],"command":[-0.8583157781604728,0.5894387159790245],"dll":[-0.8958512047456156,-0.1311609699758293],"dns query":[-0.3965886343889565,0.8046153366054791],"executable":[-1.0,0.12441688142725019],"file":[-0.04232943366064596,0.3256982219544395],"file share":[0.846950824488933,0.11077133812663864],"host":[-0.23931804005956403,-0.1202879487415345],"ip":[-0.09293702477060059,0.011102488963881697],"logon session":[0.6905967027341697,0.31075293054113134],"pipe":[-0.6636890030672432,0.7482611562469741],"port":[-0.2654496770651132,-0.3040019169811],"process":[-0.39967871564057256,0.20492157496351965],"registry key":[-0.05894740913179271,-0.2484960765972653],"registry key value":[0.15700718748509562,0.3570402532246281],"schedule task":[0.6445677188579815,-0.7050931807739589],"service":[0.8814720508404704,-0.32639879143205325],"thread":[-0.98600099423066,0.37635355395006703],"user":[0.3092142673278019,-0.15870197056836918],"wmi consumer":[0.9407117894225533,-0.10767449245162444],"wmi filter":[0.4090440848007433,-0.741661595596675],"wmi subscription":[0.772630653963621,-0.5167217921709881]}},"id":"1019","type":"StaticLayoutProvider"}],"root_ids":["1004"]},"title":"Bokeh Application","version":"2.2.2"}};
  var render_items = [{"docid":"bd0604e9-f80a-428d-b93c-ceebea11592f","root_ids":["1004"],"roots":{"1004":"0acb3eed-a42e-44f2-946c-386d70c25c57"}}];
  root.Bokeh.embed.embed_items_notebook(docs_json, render_items);

  }
  if (root.Bokeh !== undefined) {
    embed_document(root);
  } else {
    var attempts = 0;
    var timer = setInterval(function(root) {
      if (root.Bokeh !== undefined) {
        clearInterval(timer);
        embed_document(root);
      } else {
        attempts++;
        if (attempts > 100) {
          clearInterval(timer);
          console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
        }
      }
    }, 10, root)
  }
})(window);</script></div>
</div>
</div>
<div class="section" id="mapping-sub-techniques-to-data-components-relationships-event-logs">
<h2>Mapping (sub)techniques to data components &amp; relationships &amp; event logs<a class="headerlink" href="#mapping-sub-techniques-to-data-components-relationships-event-logs" title="Permalink to this headline">¶</a></h2>
<div class="section" id="gathering-att-ck-content">
<h3>Gathering ATT&amp;CK content<a class="headerlink" href="#gathering-att-ck-content" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>Importing libraries</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Importing library to interact with up to date ATT&amp;CK content available in STIX format via public TAXII server</span>
<span class="kn">from</span> <span class="nn">attackcti</span> <span class="kn">import</span> <span class="n">attack_client</span>
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p>Gathering (sub)techniques</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Instantiating attack_client class</span>
<span class="n">lift</span> <span class="o">=</span> <span class="n">attack_client</span><span class="p">()</span>

<span class="c1"># Collecting all techniques (Revoked and not revoked) for windows platform within the enterprise matrix</span>
<span class="n">attck</span> <span class="o">=</span> <span class="n">lift</span><span class="o">.</span><span class="n">get_techniques_by_platform</span><span class="p">(</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Windows&#39;</span><span class="p">,</span> <span class="n">stix_format</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span>

<span class="c1"># Removing revoked techniques</span>
<span class="n">attck</span> <span class="o">=</span> <span class="n">lift</span><span class="o">.</span><span class="n">remove_revoked</span><span class="p">(</span><span class="n">attck</span><span class="p">)</span>

<span class="c1"># Generating a dataframe with information collected</span>
<span class="n">attck</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">attck</span><span class="p">)</span>

<span class="c1"># Selecting columns</span>
<span class="n">attck</span> <span class="o">=</span> <span class="n">attck</span><span class="p">[[</span><span class="s1">&#39;tactic&#39;</span><span class="p">,</span><span class="s1">&#39;technique_id&#39;</span><span class="p">,</span><span class="s1">&#39;technique&#39;</span><span class="p">,</span><span class="s1">&#39;data_sources&#39;</span><span class="p">]]</span>

<span class="c1"># Showing information collected</span>
<span class="n">attck</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>tactic</th>
      <th>technique_id</th>
      <th>technique</th>
      <th>data_sources</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[credential-access, collection]</td>
      <td>T1557.002</td>
      <td>ARP Cache Poisoning</td>
      <td>[Packet capture, Netflow/Enclave netflow]</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[persistence, privilege-escalation]</td>
      <td>T1547.012</td>
      <td>Print Processors</td>
      <td>[Process monitoring, Windows Registry, File mo...</td>
    </tr>
    <tr>
      <th>2</th>
      <td>[defense-evasion]</td>
      <td>T1564.007</td>
      <td>VBA Stomping</td>
      <td>[Process monitoring, File monitoring]</td>
    </tr>
    <tr>
      <th>3</th>
      <td>[credential-access]</td>
      <td>T1558.004</td>
      <td>AS-REP Roasting</td>
      <td>[Windows event logs, Authentication logs]</td>
    </tr>
    <tr>
      <th>4</th>
      <td>[defense-evasion]</td>
      <td>T1218.012</td>
      <td>Verclsid</td>
      <td>[Process use of network, Process command-line ...</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Splitting data_sources field</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">attck</span> <span class="o">=</span> <span class="n">attck</span><span class="o">.</span><span class="n">explode</span><span class="p">(</span><span class="s1">&#39;data_sources&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">attck</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>tactic</th>
      <th>technique_id</th>
      <th>technique</th>
      <th>data_sources</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[credential-access, collection]</td>
      <td>T1557.002</td>
      <td>ARP Cache Poisoning</td>
      <td>Packet capture</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[credential-access, collection]</td>
      <td>T1557.002</td>
      <td>ARP Cache Poisoning</td>
      <td>Netflow/Enclave netflow</td>
    </tr>
    <tr>
      <th>2</th>
      <td>[persistence, privilege-escalation]</td>
      <td>T1547.012</td>
      <td>Print Processors</td>
      <td>Process monitoring</td>
    </tr>
    <tr>
      <th>3</th>
      <td>[persistence, privilege-escalation]</td>
      <td>T1547.012</td>
      <td>Print Processors</td>
      <td>Windows Registry</td>
    </tr>
    <tr>
      <th>4</th>
      <td>[persistence, privilege-escalation]</td>
      <td>T1547.012</td>
      <td>Print Processors</td>
      <td>File monitoring</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Updating data_sources names</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">yamlNamesUrl</span> <span class="o">=</span> <span class="s1">&#39;https://raw.githubusercontent.com/OTRF/OSSEM-DM/main/docs/mitre_attack/_new_data_sources_names.yaml&#39;</span>
<span class="n">yamlNamesContent</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">yamlNamesUrl</span><span class="p">)</span>
<span class="n">names</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">yamlNamesContent</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
<span class="n">names</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">names</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">()),</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;data_sources&#39;</span><span class="p">,</span> <span class="s1">&#39;new_names&#39;</span><span class="p">])</span>

<span class="n">attck</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">attck</span><span class="p">,</span> <span class="n">names</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;data_sources&#39;</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span>
<span class="n">namesUpdate</span> <span class="o">=</span> <span class="n">attck</span><span class="p">[</span><span class="s1">&#39;new_names&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">attck</span><span class="p">[</span><span class="s1">&#39;data_sources&#39;</span><span class="p">])</span>
<span class="n">attck</span> <span class="o">=</span> <span class="n">attck</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;new_names&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">data_sources</span> <span class="o">=</span> <span class="n">namesUpdate</span><span class="p">)</span>
<span class="n">attck</span> <span class="o">=</span> <span class="n">attck</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">(</span><span class="n">subset</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;technique_id&#39;</span><span class="p">,</span><span class="s1">&#39;data_sources&#39;</span><span class="p">])</span>\
        <span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;technique&#39;</span><span class="p">])</span>\
        <span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
<span class="n">attck</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>tactic</th>
      <th>technique_id</th>
      <th>technique</th>
      <th>data_sources</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[credential-access, collection]</td>
      <td>T1557.002</td>
      <td>ARP Cache Poisoning</td>
      <td>Packet capture</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[credential-access, collection]</td>
      <td>T1557.002</td>
      <td>ARP Cache Poisoning</td>
      <td>Netflow/Enclave netflow</td>
    </tr>
    <tr>
      <th>2</th>
      <td>[credential-access]</td>
      <td>T1558.004</td>
      <td>AS-REP Roasting</td>
      <td>Logon session</td>
    </tr>
    <tr>
      <th>3</th>
      <td>[credential-access]</td>
      <td>T1558.004</td>
      <td>AS-REP Roasting</td>
      <td>Windows event logs</td>
    </tr>
    <tr>
      <th>4</th>
      <td>[privilege-escalation, defense-evasion]</td>
      <td>T1548</td>
      <td>Abuse Elevation Control Mechanism</td>
      <td>Windows registry</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>Mapping techniques to data components &amp; relationships * event logs</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">techniques</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">attck</span><span class="p">,</span> <span class="n">dataSourcesMapping</span><span class="p">,</span> <span class="n">on</span> <span class="o">=</span> <span class="s1">&#39;data_sources&#39;</span><span class="p">,</span> <span class="n">how</span> <span class="o">=</span> <span class="s1">&#39;left&#39;</span><span class="p">)</span>\
             <span class="p">[[</span><span class="s1">&#39;tactic&#39;</span><span class="p">,</span><span class="s1">&#39;technique_id&#39;</span><span class="p">,</span><span class="s1">&#39;technique&#39;</span><span class="p">,</span><span class="s1">&#39;data_sources&#39;</span><span class="p">,</span><span class="s1">&#39;components&#39;</span><span class="p">,</span><span class="s1">&#39;data_relationships&#39;</span><span class="p">,</span>\
               <span class="s1">&#39;log_provider&#39;</span><span class="p">,</span><span class="s1">&#39;event_id&#39;</span><span class="p">]]</span>

<span class="n">techniques</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>tactic</th>
      <th>technique_id</th>
      <th>technique</th>
      <th>data_sources</th>
      <th>components</th>
      <th>data_relationships</th>
      <th>log_provider</th>
      <th>event_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>[credential-access, collection]</td>
      <td>T1557.002</td>
      <td>ARP Cache Poisoning</td>
      <td>Packet capture</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>[credential-access, collection]</td>
      <td>T1557.002</td>
      <td>ARP Cache Poisoning</td>
      <td>Netflow/Enclave netflow</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>[credential-access]</td>
      <td>T1558.004</td>
      <td>AS-REP Roasting</td>
      <td>Logon session</td>
      <td>logon session context</td>
      <td>Logon session modified</td>
      <td>Microsoft-Windows-Security-Auditing</td>
      <td>4672.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>[credential-access]</td>
      <td>T1558.004</td>
      <td>AS-REP Roasting</td>
      <td>Logon session</td>
      <td>logon session creation</td>
      <td>User requested creation Logon session</td>
      <td>Microsoft-Windows-Security-Auditing</td>
      <td>4648.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>[credential-access]</td>
      <td>T1558.004</td>
      <td>AS-REP Roasting</td>
      <td>Logon session</td>
      <td>logon session creation</td>
      <td>User requested logon session creation from Ip</td>
      <td>Microsoft-Windows-Security-Auditing</td>
      <td>4648.0</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
<div class="section" id="use-case-smb-windows-admin-shares-t1021-002">
<h3>Use Case: SMB/Windows Admin Shares (T1021.002)<a class="headerlink" href="#use-case-smb-windows-admin-shares-t1021-002" title="Permalink to this headline">¶</a></h3>
<ul class="simple">
<li><p>What are the recommended data sources?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">attck</span><span class="p">[</span><span class="n">attck</span><span class="p">[</span><span class="s1">&#39;technique_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;T1021.002&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>tactic</th>
      <th>technique_id</th>
      <th>technique</th>
      <th>data_sources</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>1091</th>
      <td>[lateral-movement]</td>
      <td>T1021.002</td>
      <td>SMB/Windows Admin Shares</td>
      <td>Logon session</td>
    </tr>
    <tr>
      <th>1092</th>
      <td>[lateral-movement]</td>
      <td>T1021.002</td>
      <td>SMB/Windows Admin Shares</td>
      <td>Process</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<ul class="simple">
<li><p>What are the potential event logs that we could consider in our analysis?</p></li>
</ul>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">techniques</span><span class="p">[</span><span class="n">techniques</span><span class="p">[</span><span class="s1">&#39;technique_id&#39;</span><span class="p">]</span><span class="o">==</span><span class="s1">&#39;T1021.002&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>tactic</th>
      <th>technique_id</th>
      <th>technique</th>
      <th>data_sources</th>
      <th>components</th>
      <th>data_relationships</th>
      <th>log_provider</th>
      <th>event_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>17642</th>
      <td>[lateral-movement]</td>
      <td>T1021.002</td>
      <td>SMB/Windows Admin Shares</td>
      <td>Logon session</td>
      <td>logon session context</td>
      <td>Logon session modified</td>
      <td>Microsoft-Windows-Security-Auditing</td>
      <td>4672.0</td>
    </tr>
    <tr>
      <th>17643</th>
      <td>[lateral-movement]</td>
      <td>T1021.002</td>
      <td>SMB/Windows Admin Shares</td>
      <td>Logon session</td>
      <td>logon session creation</td>
      <td>User requested creation Logon session</td>
      <td>Microsoft-Windows-Security-Auditing</td>
      <td>4648.0</td>
    </tr>
    <tr>
      <th>17644</th>
      <td>[lateral-movement]</td>
      <td>T1021.002</td>
      <td>SMB/Windows Admin Shares</td>
      <td>Logon session</td>
      <td>logon session creation</td>
      <td>User requested logon session creation from Ip</td>
      <td>Microsoft-Windows-Security-Auditing</td>
      <td>4648.0</td>
    </tr>
    <tr>
      <th>17645</th>
      <td>[lateral-movement]</td>
      <td>T1021.002</td>
      <td>SMB/Windows Admin Shares</td>
      <td>Logon session</td>
      <td>logon session creation</td>
      <td>User requested logon session creation from Port</td>
      <td>Microsoft-Windows-Security-Auditing</td>
      <td>4648.0</td>
    </tr>
    <tr>
      <th>17646</th>
      <td>[lateral-movement]</td>
      <td>T1021.002</td>
      <td>SMB/Windows Admin Shares</td>
      <td>Logon session</td>
      <td>logon session creation</td>
      <td>User created Logon session</td>
      <td>Microsoft-Windows-Security-Auditing</td>
      <td>4624.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>17708</th>
      <td>[lateral-movement]</td>
      <td>T1021.002</td>
      <td>SMB/Windows Admin Shares</td>
      <td>Process</td>
      <td>process network connection</td>
      <td>Process bound to Port</td>
      <td>Microsoft-Windows-Security-Auditing</td>
      <td>5158.0</td>
    </tr>
    <tr>
      <th>17709</th>
      <td>[lateral-movement]</td>
      <td>T1021.002</td>
      <td>SMB/Windows Admin Shares</td>
      <td>Process</td>
      <td>process network connection</td>
      <td>Host blocked local port bind on Process</td>
      <td>Microsoft-Windows-Security-Auditing</td>
      <td>5159.0</td>
    </tr>
    <tr>
      <th>17710</th>
      <td>[lateral-movement]</td>
      <td>T1021.002</td>
      <td>SMB/Windows Admin Shares</td>
      <td>Process</td>
      <td>process network connection</td>
      <td>Host blocked local port bind on Ip</td>
      <td>Microsoft-Windows-Security-Auditing</td>
      <td>5159.0</td>
    </tr>
    <tr>
      <th>17711</th>
      <td>[lateral-movement]</td>
      <td>T1021.002</td>
      <td>SMB/Windows Admin Shares</td>
      <td>Process</td>
      <td>process network connection</td>
      <td>Host blocked local port bind on Port</td>
      <td>Microsoft-Windows-Security-Auditing</td>
      <td>5159.0</td>
    </tr>
    <tr>
      <th>17712</th>
      <td>[lateral-movement]</td>
      <td>T1021.002</td>
      <td>SMB/Windows Admin Shares</td>
      <td>Process</td>
      <td>process network connection</td>
      <td>Process attempted to bind on Port</td>
      <td>Microsoft-Windows-Security-Auditing</td>
      <td>5159.0</td>
    </tr>
  </tbody>
</table>
<p>71 rows × 8 columns</p>
</div></div></div>
</div>
<ul class="simple">
<li><p><strong>Contribution opportunity identified after testing the framework!!</strong></p></li>
</ul>
<p>The <a class="reference external" href="https://github.com/OTRF/mordor">Mordor</a> project contains a dataset that represents a variation of the <a class="reference external" href="https://mordordatasets.com/notebooks/small/windows/08_lateral_movement/SDWIN-200806015757.html">SMB/Windows Admin Shares (T1021.002)</a> sub-technique.</p>
<p><strong>Offensive tradecraft:</strong> Adversaries leverage SMB to copy files over the network to either execute code remotely or exfiltrate data.</p>
<p><strong>Initial detection strategy:</strong> Using the data sources recommended by the ATT&amp;CK team, we were able to get some context related to the adversary behavior from a Procees and User Authentication perspective. However, more context around the manipulation or creation of files might be helpful to define a better detection strategy.</p>
<p><strong>Contribution opportunity:</strong> Security event logs such as <strong>5140 (A network share object was accessed)</strong> and <strong>5145 (A network share object was checked)</strong> from Windows Security Auditing and <strong>11 (File created)</strong>  from Sysmon can help us with the conext required to define a detection strategy for this specific sub-technqiue variation. Therefore, adding the <strong>File data source object</strong> (file share access &amp; file access data components) to the recommended data sources for this sub-technique might be a good idea.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dataSourcesMapping</span><span class="p">[[</span><span class="s1">&#39;data_sources&#39;</span><span class="p">,</span><span class="s1">&#39;components&#39;</span><span class="p">,</span><span class="s1">&#39;data_relationships&#39;</span><span class="p">,</span><span class="s1">&#39;log_provider&#39;</span><span class="p">,</span><span class="s1">&#39;event_id&#39;</span><span class="p">]][(</span><span class="n">dataSourcesMapping</span><span class="p">[</span><span class="s1">&#39;data_sources&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;File&#39;</span><span class="p">)</span> <span class="o">&amp;</span> \
                   <span class="p">((</span><span class="n">dataSourcesMapping</span><span class="p">[</span><span class="s1">&#39;event_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5140</span><span class="p">)</span> <span class="o">|</span>\
                    <span class="p">(</span><span class="n">dataSourcesMapping</span><span class="p">[</span><span class="s1">&#39;event_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">5145</span><span class="p">)</span> <span class="o">|</span>\
                    <span class="p">(</span><span class="n">dataSourcesMapping</span><span class="p">[</span><span class="s1">&#39;event_id&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">11</span><span class="p">))]</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>data_sources</th>
      <th>components</th>
      <th>data_relationships</th>
      <th>log_provider</th>
      <th>event_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>87</th>
      <td>File</td>
      <td>file creation</td>
      <td>Process created File</td>
      <td>Microsoft-Windows-Sysmon</td>
      <td>11</td>
    </tr>
    <tr>
      <th>92</th>
      <td>File</td>
      <td>file access</td>
      <td>User accessed File</td>
      <td>Microsoft-Windows-Security-Auditing</td>
      <td>5145</td>
    </tr>
    <tr>
      <th>103</th>
      <td>File</td>
      <td>file modification</td>
      <td>Process modified File</td>
      <td>Microsoft-Windows-Sysmon</td>
      <td>11</td>
    </tr>
    <tr>
      <th>108</th>
      <td>File</td>
      <td>file share access</td>
      <td>User accessed File Share</td>
      <td>Microsoft-Windows-Security-Auditing</td>
      <td>5140</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</div>
</div>
<div class="section" id="i-hope-you-find-this-notebook-helpful-d">
<h2>I hope you find this notebook helpful!! :D<a class="headerlink" href="#i-hope-you-find-this-notebook-helpful-d" title="Permalink to this headline">¶</a></h2>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "OTRF/OSSEM",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        </div>
    </div>
    
    
    <div class='prev-next-bottom'>
        

    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Roberto Rodriguez @Cyb3rWard0g<br/>
        
            &copy; Copyright 2020.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>

    <script src="../_static/js/index.js"></script>
    
  </body>
</html>